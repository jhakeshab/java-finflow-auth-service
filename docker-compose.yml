services:
  java-finflow-auth-service:
    build: .
    ports: ["9001:9001"]
    environment:
      SPRING_DATASOURCE_URL: jdbc:postgresql://postgres:5432/finflow
      SPRING_DATASOURCE_USERNAME: finflow
      SPRING_DATASOURCE_PASSWORD: finflow
      SPRING_REDIS_HOST: redis
      SPRING_REDIS_PORT: 6379
      SPRING_KAFKA_BOOTSTRAPSERVERS: kafka:9092
      AUTH_SERVICE_URL: http://java-finflow-auth-service:9001
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
    networks:
      - finflow-shared
  postgres:
    image: postgres:15
    environment:
      POSTGRES_DB: finflow
      POSTGRES_USER: finflow
      POSTGRES_PASSWORD: finflow
    ports: ["5432"]
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U finflow"]
      interval: 5s
      timeout: 5s
      retries: 10
    networks:
      - finflow-shared
  redis:
    image: redis:7
    ports: ["6379"]
    networks:
      - finflow-shared
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 5s
      timeout: 3s
      retries: 5

networks:
  finflow-shared:
    external: true  # ‚Üê Must be pre-created
    name: finflow-java-shared